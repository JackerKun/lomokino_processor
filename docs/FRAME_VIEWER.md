# 🖼️ 帧查看器功能

## 🎯 新增功能

### 1. ✅ 清空所有帧
在"提取的帧"区域添加了"🗑️ 清空所有帧"按钮，可以一键删除所有已提取的帧。

**位置**: 提取的帧区域右上角

**功能**:
- 点击按钮弹出确认对话框
- 确认后清空所有帧
- 更新帧数统计
- 重置提示信息

**使用场景**:
- 重新开始提取
- 清理错误的提取结果
- 准备处理新的胶片

### 2. ✅ 大图查看器
双击任意帧，弹出全屏查看器，支持键盘导航。

**触发方式**:
- 双击任意帧缩略图

**功能特性**:
- 🖼️ 全尺寸显示帧内容
- ⬅️ 左箭头键 - 查看上一帧
- ➡️ 右箭头键 - 查看下一帧
- 🔢 显示当前帧号和总帧数
- 🖱️ 按钮导航 - "上一帧" / "下一帧"
- ❌ ESC键或"关闭"按钮退出

---

## 🚀 使用方法

### 清空所有帧

**步骤**:
1. 提取一些帧（自动或手动）
2. 点击右上角的"🗑️ 清空所有帧"按钮
3. 在确认对话框中点击"确定"
4. 所有帧被清空，可以重新开始

**效果**:
```
修改前:
总共 8 帧

修改后:
提取的帧将显示在这里
可拖动帧来调整顺序
```

### 大图查看

**步骤**:
1. 提取一些帧
2. **双击**任意帧缩略图
3. 弹出大图查看器窗口
4. 使用导航查看其他帧：
   - 点击"⬅️ 上一帧"按钮
   - 点击"下一帧 ➡️"按钮
   - 按键盘**左箭头**键
   - 按键盘**右箭头**键
5. 按**ESC**键或点击"关闭"按钮退出

**界面布局**:
```
┌─────────────────────────────────────────┐
│  帧 3 / 8                                │ ← 窗口标题
├─────────────────────────────────────────┤
│                                         │
│                                         │
│         [大图显示区域]                   │ ← 帧全尺寸显示
│                                         │
│                                         │
├─────────────────────────────────────────┤
│   [⬅️ 上一帧]  3 / 8  [下一帧 ➡️]       │ ← 导航按钮
│                                         │
│            [关闭]                        │ ← 关闭按钮
└─────────────────────────────────────────┘
```

---

## 💡 使用技巧

### 技巧1: 快速浏览所有帧

```
1. 双击第一帧
2. 连续按右箭头键快速浏览
3. 发现问题帧时记录帧号
4. 按ESC退出
5. 点击对应帧的删除按钮
```

### 技巧2: 检查提取质量

**工作流程**:
```
提取帧 → 双击查看 → 检查质量
  ↓
质量好 → 继续生成视频
  ↓
质量差 → 清空所有帧 → 重新调整参数 → 再次提取
```

### 技巧3: 对比相邻帧

```
1. 双击某一帧
2. 使用左右箭头快速切换
3. 观察帧之间的连续性
4. 检测是否有重复或缺失的帧
```

---

## 🎨 界面元素详解

### 清空所有帧按钮

**外观**:
- 颜色: 橙红色 (#ff5722)
- 图标: 🗑️
- 位置: 提取的帧区域右上角

**状态**:
- 有帧时: 可点击
- 无帧时: 自动跳过（不会报错）

**样式**:
```python
背景色: #ff5722 (橙红色)
悬停色: #e64a19 (深橙红)
文字: 白色
圆角: 4px
```

### 大图查看器

**窗口大小**:
- 最小尺寸: 800 x 600
- 可调整大小: ✅
- 自适应显示: ✅

**导航按钮**:
- 上一帧: 第一帧时禁用
- 下一帧: 最后一帧时禁用
- 关闭: 始终可用

**键盘快捷键**:
- ⬅️ 左箭头: 上一帧
- ➡️ 右箭头: 下一帧
- ESC: 关闭查看器

**帧显示**:
- 背景: 黑色 (#000)
- 边框: 深灰色 (#333)
- 缩放: 保持宽高比
- 质量: 平滑插值

---

## 📊 功能对比

| 功能 | 缩略图 | 大图查看器 |
|------|--------|------------|
| 尺寸 | 110x110 | 800x600+ |
| 删除 | ✅ | ❌ |
| 查看详情 | ❌ | ✅ |
| 导航 | 点击 | 键盘/按钮 |
| 全屏 | ❌ | ✅ |

---

## 🔍 技术实现

### FrameViewerDialog 类

**核心功能**:
```python
class FrameViewerDialog(QDialog):
    """大图查看器对话框"""

    def __init__(self, frames, current_index, parent):
        # 初始化
        self.frames = frames           # 所有帧
        self.current_index = current_index  # 当前帧索引

    def show_current_frame(self):
        # 显示当前帧
        # 1. 将numpy数组转为QPixmap
        # 2. 缩放到合适尺寸
        # 3. 保持宽高比
        # 4. 更新计数器

    def keyPressEvent(self, event):
        # 处理键盘事件
        # 左箭头 → 上一帧
        # 右箭头 → 下一帧
        # ESC → 关闭
```

### ExtractedFramesWidget 新增方法

**view_frame()**:
```python
def view_frame(self, index):
    """查看指定帧"""
    if 0 <= index < len(self.frames):
        viewer = FrameViewerDialog(self.frames, index, self)
        viewer.exec()  # 模态显示
```

**clear_all_frames()**:
```python
def clear_all_frames(self):
    """清空所有帧"""
    if len(self.frames) == 0:
        return  # 无帧时直接返回

    # 显示确认对话框
    dialog = ConfirmDialog(...)

    if confirmed:
        self.frames.clear()
        self.set_frames([])  # 刷新显示
```

### FrameThumbnail 新增事件

**mouseDoubleClickEvent()**:
```python
def mouseDoubleClickEvent(self, event):
    """双击事件"""
    if event.button() == Qt.MouseButton.LeftButton:
        self.parent_widget.view_frame(self.index)
```

---

## ⚠️ 注意事项

### 1. 清空确认

清空所有帧是**不可逆**操作：
- ✅ 始终弹出确认对话框
- ✅ 显示要清空的帧数量
- ❌ 清空后无法恢复

**建议**:
- 清空前确认不再需要这些帧
- 如有疑虑，先删除单个帧而非全部清空

### 2. 大图性能

查看大量帧时：
- ✅ 每次只加载当前帧
- ✅ 内存占用合理
- ✅ 切换流畅

**限制**:
- 窗口可调整大小
- 图像会自动缩放适应窗口

### 3. 导航边界

在第一帧或最后一帧时：
- 上一帧按钮/左箭头: 禁用（第一帧）
- 下一帧按钮/右箭头: 禁用（最后一帧）
- 视觉提示: 按钮变灰

---

## 🎬 使用场景示例

### 场景1: 质量检查工作流

```
1. 自动提取 old.jpg → 得到8帧
2. 双击第1帧 → 打开查看器
3. 按右箭头快速浏览8帧
4. 发现第3帧模糊
5. 按ESC关闭查看器
6. 点击第3帧的 × 删除
7. 剩余7帧 → 生成视频
```

### 场景2: 重新提取工作流

```
1. 自动检测提取 → 20帧（过多）
2. 点击"清空所有帧" → 确认清空
3. 切换到手动选择模式
4. 添加8个选择框
5. 手动提取 → 得到8帧
6. 双击查看验证 → 质量完美
7. 生成视频
```

### 场景3: 帧顺序调整

```
1. 提取10帧
2. 双击查看发现帧5和帧6顺序错了
3. （未来功能）拖动调整顺序
4. 双击再次验证 → 顺序正确
5. 生成视频
```

---

## ✅ 改进效果

### 用户体验提升

**修改前**:
- ❌ 只能看小缩略图
- ❌ 无法查看帧细节
- ❌ 删除帧需要逐个操作
- ❌ 重新开始很麻烦

**修改后**:
- ✅ 双击查看大图
- ✅ 键盘快速导航
- ✅ 一键清空所有帧
- ✅ 工作流程更流畅

### 功能完整性

| 操作 | 支持 | 说明 |
|------|------|------|
| 查看单个帧 | ✅ | 双击 |
| 删除单个帧 | ✅ | 点击 × |
| 清空所有帧 | ✅ | 新增按钮 |
| 帧间导航 | ✅ | 左右箭头 |
| 全屏查看 | ✅ | 大图查看器 |
| 拖动排序 | 🔜 | 计划中 |

---

## 🔜 未来改进

### 计划中的功能

1. **帧编辑**
   - 旋转帧
   - 裁剪帧
   - 调整亮度/对比度

2. **批量操作**
   - 全选/反选
   - 批量删除
   - 批量导出

3. **更多导航**
   - Home/End键跳转首尾
   - Page Up/Down翻页
   - 数字键快速跳转

4. **缩放功能**
   - 鼠标滚轮缩放
   - 拖动平移
   - 适应窗口/原始尺寸切换

---

**现在可以更方便地查看和管理提取的帧了！** 🎬✨
