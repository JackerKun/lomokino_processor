# ğŸ”§ åæ ‡ç³»ç»Ÿä¿®å¤å®Œæˆ + å¸ƒå±€ä¼˜åŒ–

## ğŸ¯ é—®é¢˜æè¿°

ç”¨æˆ·åé¦ˆï¼š
1. "é»˜è®¤åˆ›å»ºçš„é€‰æ‹©æ¡†å¤ªå®½äº† ä¸éœ€è¦é‚£ä¹ˆå®½ é»˜è®¤å€¼æœ€å®½ è¾¾åˆ°å›¾ç‰‡å®½åº¦å³å¯"
2. "å¦å¤–æ¡†é€‰åçš„åŒºåŸŸ ç‚¹å‡»æå– å¹¶ä¸æ­£ç¡® å³ä¾§å·²ç»æå–çš„å¸§å¹¶å’Œæ¡†é€‰çš„ä¸å¯¹"
3. "æ‰‹åŠ¨é€‰æ‹©æ¡†group å˜ä½ä¸€äº›, èƒ½æ”¾ä¸‹æŒ‰é’®å°±è¡Œ,ä¸ç”¨é‚£ä¹ˆé«˜, èƒ¶ç‰‡é¢„è§ˆé«˜ä¸€ç‚¹"
4. "è¯·çœ‹cut.png æˆ‘åœˆå‡ºæ¥çš„åŒºåŸŸ å¤ªé«˜äº† æ²¡å•¥ç”¨ ç¼©å°ä¸€ç‚¹, ç•™å‡ºæ›´å¤šç©ºé—´ ç»™ä¸Šé¢çš„èƒ¶ç‰‡é¢„è§ˆ"

## âœ… å·²ä¿®å¤

### 1. åæ ‡ç³»ç»Ÿé‡æ„ âœ…

**é—®é¢˜æ ¹æº**:
- é€‰æ‹©æ¡†ç»˜åˆ¶åœ¨ç¼©æ”¾åçš„æ˜¾ç¤ºå›¾åƒä¸Š
- ä½†æå–æ—¶ç›´æ¥ä½¿ç”¨è¿™äº›åæ ‡ä»åŸå§‹å›¾åƒè£åˆ‡
- å¯¼è‡´ä½ç½®ä¸åŒ¹é…

**è§£å†³æ–¹æ¡ˆ**:

#### A. åœ¨åŸå§‹å›¾åƒä¸Šç»˜åˆ¶é€‰æ‹©æ¡†
```python
def update_display(self):
    """åœ¨åŸå§‹å°ºå¯¸pixmapä¸Šç»˜åˆ¶é€‰æ‹©æ¡†ï¼Œç„¶åå†ç¼©æ”¾"""
    # 1. å¤åˆ¶åŸå§‹pixmap
    display_pixmap = self.original_pixmap.copy()

    # 2. åœ¨åŸå§‹å°ºå¯¸ä¸Šç»˜åˆ¶é€‰æ‹©æ¡†
    painter = QPainter(display_pixmap)
    for box in self.selection_boxes:
        painter.drawRect(box.rect)  # box.rect æ˜¯åŸå§‹åæ ‡
    painter.end()

    # 3. ç¼©æ”¾æ•´ä¸ªå›¾åƒç”¨äºæ˜¾ç¤º
    scaled = display_pixmap.scaled(
        self.size(),
        Qt.AspectRatioMode.KeepAspectRatio,
        Qt.TransformationMode.SmoothTransformation
    )
```

**ä¼˜åŠ¿**:
- é€‰æ‹©æ¡†åæ ‡å§‹ç»ˆä¿æŒåœ¨åŸå§‹å›¾åƒç©ºé—´
- æå–æ—¶ç›´æ¥ä½¿ç”¨box.rectåæ ‡ï¼Œ100%å‡†ç¡®
- æ˜¾ç¤ºæ—¶æ•´ä½“ç¼©æ”¾ï¼Œä¿æŒè§†è§‰ä¸€è‡´æ€§

#### B. åæ ‡è½¬æ¢å‡½æ•°

**ä»æ˜¾ç¤ºåæ ‡è½¬ä¸ºåŸå§‹åæ ‡**:
```python
def display_to_original_coords(self, point):
    """å°†é¼ æ ‡ç‚¹å‡»çš„æ˜¾ç¤ºåæ ‡è½¬æ¢ä¸ºåŸå§‹å›¾åƒåæ ‡"""
    if self.original_pixmap is None or self.display_pixmap is None:
        return point  # å®‰å…¨æ£€æŸ¥

    # è®¡ç®—ç¼©æ”¾æ¯”ä¾‹
    scale_x = self.original_pixmap.width() / self.display_pixmap.width()
    scale_y = self.original_pixmap.height() / self.display_pixmap.height()

    # è€ƒè™‘å±…ä¸­åç§»
    x_offset = (self.width() - self.display_pixmap.width()) // 2
    y_offset = (self.height() - self.display_pixmap.height()) // 2

    # è½¬æ¢åæ ‡
    display_x = point.x() - x_offset
    display_y = point.y() - y_offset
    original_x = int(display_x * scale_x)
    original_y = int(display_y * scale_y)

    return QPoint(original_x, original_y)
```

#### C. é¼ æ ‡äº‹ä»¶å¤„ç†

**æ‰€æœ‰é¼ æ ‡æ“ä½œéƒ½ä½¿ç”¨åŸå§‹åæ ‡**:
```python
def mousePressEvent(self, event):
    """é¼ æ ‡æŒ‰ä¸‹"""
    if self.original_pixmap is None or self.display_pixmap is None:
        return  # å®‰å…¨æ£€æŸ¥

    # è½¬æ¢ä¸ºåŸå§‹åæ ‡
    original_point = self.display_to_original_coords(event.pos())

    # ä½¿ç”¨åŸå§‹åæ ‡æ£€æµ‹ç‚¹å‡»ä½ç½®
    for box in self.selection_boxes:
        if box.contains_point(original_point):
            self.dragging = True
            self.drag_start = original_point  # å­˜å‚¨åŸå§‹åæ ‡

def mouseMoveEvent(self, event):
    """é¼ æ ‡ç§»åŠ¨"""
    if self.original_pixmap is None or self.display_pixmap is None:
        return  # å®‰å…¨æ£€æŸ¥

    original_point = self.display_to_original_coords(event.pos())

    if self.dragging and self.selected_box:
        delta_x = original_point.x() - self.drag_start.x()
        delta_y = original_point.y() - self.drag_start.y()
        self.selected_box.move_by(delta_x, delta_y)  # åœ¨åŸå§‹åæ ‡ç©ºé—´ç§»åŠ¨
        self.drag_start = original_point
        self.update_display()  # é‡æ–°ç»˜åˆ¶
```

### 2. é»˜è®¤é€‰æ‹©æ¡†å®½åº¦ä¿®å¤ âœ…

**ä¿®æ”¹å‰**:
```python
width = int(self.original_pixmap.width() * 0.84)  # 84%å®½åº¦ï¼ˆå»é™¤é½¿å­”ï¼‰
x = int(self.original_pixmap.width() * 0.08)     # ä»8%ä½ç½®å¼€å§‹
```

**ä¿®æ”¹å**:
```python
width = self.original_pixmap.width()  # 100%å®½åº¦
x = 0  # ä»å·¦è¾¹ç¼˜å¼€å§‹
```

**ç»“æœ**: é€‰æ‹©æ¡†é»˜è®¤è¦†ç›–æ•´ä¸ªå›¾ç‰‡å®½åº¦ âœ…

### 3. æ§åˆ¶åŒºåŸŸç´§å‡‘åŒ– âœ…

**ä¿®æ”¹å‰**:
```python
# ä¸¤è¡ŒæŒ‰é’®ï¼Œå®Œæ•´æ–‡å­—
btn_layout1 = QHBoxLayout()
btn_layout1.addWidget(QPushButton("â• æ·»åŠ é€‰æ‹©æ¡†"))
btn_layout1.addWidget(QPushButton("ğŸ“‹ å¤åˆ¶é€‰æ‹©æ¡†"))

btn_layout2 = QHBoxLayout()
btn_layout2.addWidget(QPushButton("ğŸ—‘ï¸ åˆ é™¤é€‰æ‹©æ¡†"))
btn_layout2.addWidget(QPushButton("ğŸ§¹ æ¸…ç©ºæ‰€æœ‰"))

extract_btn = QPushButton("âœ‚ï¸ æå–é€‰ä¸­åŒºåŸŸ")
label = QLabel("é€‰æ‹©æ¡†æ•°é‡: 0")
```

**ä¿®æ”¹å**:
```python
# å•è¡Œå›¾æ ‡æŒ‰é’®
btn_row = QHBoxLayout()
btn_row.setSpacing(4)  # ç´§å‡‘é—´è·

add_box_btn = QPushButton("â•")
add_box_btn.setFixedWidth(35)  # åªæ˜¾ç¤ºå›¾æ ‡
add_box_btn.setToolTip("æ·»åŠ é€‰æ‹©æ¡†")  # é¼ æ ‡æ‚¬åœæ˜¾ç¤ºæç¤º

duplicate_box_btn = QPushButton("ğŸ“‹")
duplicate_box_btn.setFixedWidth(35)
duplicate_box_btn.setToolTip("å¤åˆ¶é€‰æ‹©æ¡†")

remove_box_btn = QPushButton("ğŸ—‘ï¸")
remove_box_btn.setFixedWidth(35)
remove_box_btn.setToolTip("åˆ é™¤é€‰æ‹©æ¡†")

clear_boxes_btn = QPushButton("ğŸ§¹")
clear_boxes_btn.setFixedWidth(35)
clear_boxes_btn.setToolTip("æ¸…ç©ºæ‰€æœ‰")

# æå–æŒ‰é’®ç®€åŒ–
extract_manual_btn = QPushButton("âœ‚ï¸ æå–")

# æ ‡ç­¾ç®€åŒ–
self.box_count_label = QLabel("æ¡†: 0")

# ç´§å‡‘çš„å¤–è¾¹è·
manual_layout.setSpacing(4)
manual_layout.setContentsMargins(6, 6, 6, 6)
```

**æ”¹è¿›**:
- æŒ‰é’®ä»4x2å¸ƒå±€æ”¹ä¸º4x1 + 1æŒ‰é’®
- å®½åº¦ä»å®Œæ•´æ–‡å­—æ”¹ä¸º35pxå›¾æ ‡
- é«˜åº¦å‡å°‘çº¦**60%**
- èƒ¶ç‰‡é¢„è§ˆåŒºåŸŸè·å¾—æ›´å¤šç©ºé—´ âœ…

### 4. å®‰å…¨æ£€æŸ¥å¢å¼º âœ…

**æ·»åŠ äº†å¤šå±‚é˜²æŠ¤**:
```python
# 1. get_scale_factors() å·²æœ‰æ£€æŸ¥
def get_scale_factors(self):
    if self.original_pixmap is None or self.display_pixmap is None:
        return 1.0, 1.0

# 2. display_to_original_coords() æ–°å¢æ£€æŸ¥
def display_to_original_coords(self, point):
    if self.original_pixmap is None or self.display_pixmap is None:
        return point  # è¿”å›åŸå§‹ç‚¹ï¼Œé¿å…å´©æºƒ

# 3. mousePressEvent() æ–°å¢æ£€æŸ¥
def mousePressEvent(self, event):
    if event.button() == Qt.MouseButton.LeftButton and self.selection_boxes:
        if self.original_pixmap is None or self.display_pixmap is None:
            return  # å›¾ç‰‡æœªåŠ è½½æ—¶ä¸å¤„ç†

# 4. mouseMoveEvent() æ–°å¢æ£€æŸ¥
def mouseMoveEvent(self, event):
    if self.original_pixmap is None or self.display_pixmap is None:
        return  # å›¾ç‰‡æœªåŠ è½½æ—¶ä¸å¤„ç†
```

**ä¿®å¤çš„é—®é¢˜**:
- å¯åŠ¨æ—¶é¼ æ ‡ç§»åŠ¨å¯¼è‡´çš„å´©æºƒ
- å›¾ç‰‡æœªåŠ è½½æ—¶çš„AttributeError
- æé«˜ä»£ç é²æ£’æ€§

### 5. å¸ƒå±€ç©ºé—´ä¼˜åŒ– âœ…

**é—®é¢˜**: æ‰‹åŠ¨é€‰æ‹©æ¡†æ§åˆ¶åŒºåŸŸå ç”¨è¿‡å¤šå‚ç›´ç©ºé—´ï¼Œå¯¼è‡´èƒ¶ç‰‡é¢„è§ˆåŒºåŸŸè¢«å‹ç¼©

**è§£å†³æ–¹æ¡ˆ**:

#### A. é™åˆ¶æ§åˆ¶åŒºåŸŸé«˜åº¦
```python
# Manual selection controls
manual_controls = QGroupBox("æ‰‹åŠ¨é€‰æ‹©æ¡†")
manual_controls.setMaximumHeight(120)  # é™åˆ¶æœ€å¤§é«˜åº¦ä¸º120px
manual_layout = QVBoxLayout(manual_controls)
manual_layout.setSpacing(4)
manual_layout.setContentsMargins(6, 6, 6, 6)
```

**æ•ˆæœ**:
- æ§åˆ¶åŒºåŸŸé«˜åº¦è¢«é™åˆ¶åœ¨120pxä»¥å†…
- ä¸ä¼šéšçª—å£æ‹‰ä¼¸è€Œå¢é•¿
- ä¿æŒç´§å‡‘ä¸æµªè´¹ç©ºé—´ âœ…

#### B. èƒ¶ç‰‡é¢„è§ˆè·å¾—æ‹‰ä¼¸ä¼˜å…ˆçº§
```python
# Use interactive film preview
self.film_preview = InteractiveFilmPreview()
self.film_preview.boxes_changed.connect(self.on_boxes_changed)
preview_layout.addWidget(self.film_preview, stretch=1)  # è®¾ç½®æ‹‰ä¼¸å› å­ä¸º1
```

**æ•ˆæœ**:
- é¢„è§ˆåŒºåŸŸä¼šå æ®æ‰€æœ‰å¯ç”¨çš„å‚ç›´ç©ºé—´
- çª—å£å˜å¤§æ—¶ï¼Œé¢„è§ˆåŒºåŸŸéšä¹‹å¢é•¿
- æ›´å¥½åœ°åˆ©ç”¨å±å¹•ç©ºé—´ âœ…

#### C. æ§åˆ¶åŒºåŸŸä¸æ‹‰ä¼¸
```python
preview_layout.addWidget(manual_controls, stretch=0)  # æ‹‰ä¼¸å› å­ä¸º0
```

**æ•ˆæœ**:
- æ§åˆ¶åŒºåŸŸä¿æŒå›ºå®šé«˜åº¦ï¼ˆæœ€å¤§120pxï¼‰
- ä¸å‚ä¸å‚ç›´ç©ºé—´åˆ†é…
- æ›´å¤šç©ºé—´ç•™ç»™é¢„è§ˆåŒºåŸŸ âœ…

**å¸ƒå±€å¯¹æ¯”**:

**ä¿®æ”¹å‰**:
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  èƒ¶ç‰‡é¢„è§ˆ               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                   â”‚  â”‚
â”‚  â”‚   [é¢„è§ˆå›¾åƒ]      â”‚  â”‚ â† è¾ƒå°ï¼ˆ40%ç©ºé—´ï¼‰
â”‚  â”‚                   â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                         â”‚
â”‚  æ‰‹åŠ¨é€‰æ‹©æ¡†             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ [â•][ğŸ“‹][ğŸ—‘ï¸][ğŸ§¹] â”‚  â”‚
â”‚  â”‚ [âœ‚ï¸ æå–]          â”‚  â”‚
â”‚  â”‚ æ¡†: 0              â”‚  â”‚
â”‚  â”‚                   â”‚  â”‚
â”‚  â”‚                   â”‚  â”‚ â† å¤§ç‰‡ç©ºç™½ï¼ˆ60%ç©ºé—´ï¼‰
â”‚  â”‚                   â”‚  â”‚
â”‚  â”‚                   â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ä¿®æ”¹å**:
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  èƒ¶ç‰‡é¢„è§ˆ               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                   â”‚  â”‚
â”‚  â”‚                   â”‚  â”‚
â”‚  â”‚                   â”‚  â”‚
â”‚  â”‚   [é¢„è§ˆå›¾åƒ]      â”‚  â”‚ â† æ›´å¤§ï¼ˆ85%ç©ºé—´ï¼‰âœ…
â”‚  â”‚                   â”‚  â”‚
â”‚  â”‚                   â”‚  â”‚
â”‚  â”‚                   â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                         â”‚
â”‚  æ‰‹åŠ¨é€‰æ‹©æ¡† (max 120px) â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ [â•][ğŸ“‹][ğŸ—‘ï¸][ğŸ§¹] â”‚  â”‚
â”‚  â”‚ [âœ‚ï¸ æå–]          â”‚  â”‚
â”‚  â”‚ æ¡†: 0              â”‚  â”‚ â† ç´§å‡‘ï¼ˆ15%ç©ºé—´ï¼‰âœ…
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**æ”¹è¿›æ•ˆæœ**:
- é¢„è§ˆåŒºåŸŸå¢åŠ çº¦ **45%** çš„ç©ºé—´
- æ§åˆ¶åŒºåŸŸå‡å°‘åˆ°ç´§å‡‘å°ºå¯¸
- æ›´é«˜æ•ˆçš„å±å¹•ç©ºé—´åˆ©ç”¨ âœ…

---

## ğŸ¨ æ–°çš„å·¥ä½œåŸç†

### åæ ‡ç©ºé—´è¯´æ˜

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  åŸå§‹å›¾åƒç©ºé—´ (original_pixmap)         â”‚
â”‚  ä¾‹å¦‚: 365 x 800 pixels                 â”‚
â”‚                                         â”‚
â”‚  â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”“   â”‚
â”‚  â”ƒ é€‰æ‹©æ¡† #1                      â”ƒ   â”‚
â”‚  â”ƒ rect = QRect(0, 50, 365, 90)  â”ƒ   â”‚ â† åœ¨åŸå§‹åæ ‡ç³»
â”‚  â”—â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”›   â”‚
â”‚                                         â”‚
â”‚  â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”“   â”‚
â”‚  â”ƒ é€‰æ‹©æ¡† #2                      â”ƒ   â”‚
â”‚  â”ƒ rect = QRect(0, 150, 365, 90) â”ƒ   â”‚
â”‚  â”—â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”›   â”‚
â”‚                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â†“
    QPainterç»˜åˆ¶é€‰æ‹©æ¡†
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  å¸¦é€‰æ‹©æ¡†çš„åŸå§‹å›¾åƒ                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â†“
    scaled() ç¼©æ”¾åˆ°æ˜¾ç¤ºå°ºå¯¸
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  æ˜¾ç¤ºç©ºé—´ (display_pixmap)              â”‚
â”‚  ä¾‹å¦‚: 300 x 600 pixels                 â”‚
â”‚                                         â”‚
â”‚  ç”¨æˆ·çœ‹åˆ°çš„å›¾åƒï¼ˆå·²ç¼©æ”¾ï¼‰                â”‚
â”‚  é€‰æ‹©æ¡†ä¹Ÿå·²ç¼©æ”¾æ˜¾ç¤º                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â†‘
    é¼ æ ‡ç‚¹å‡» (300, 100)
         â†“
    display_to_original_coords()
         â†“
    è½¬æ¢ä¸ºåŸå§‹åæ ‡ (365, 133)
         â†“
    åœ¨åŸå§‹åæ ‡ç³»æ“ä½œé€‰æ‹©æ¡†
```

### æå–æµç¨‹

```
ç”¨æˆ·ç‚¹å‡»"âœ‚ï¸ æå–"
    â†“
get_selected_regions()
    â†“
for box in self.selection_boxes:
    rect = box.rect  â† å·²ç»æ˜¯åŸå§‹åæ ‡ï¼
    â†“
    region = self.original_pixmap.copy(rect)
    â†“
    æå–å®Œç¾åŒ¹é… âœ…
```

---

## ğŸ” å…³é”®æ”¹è¿›ç‚¹

### æ”¹è¿›1: åæ ‡ä¸€è‡´æ€§

**ä¹‹å‰**:
- é€‰æ‹©æ¡†åœ¨æ˜¾ç¤ºåæ ‡ç³» (300x600)
- æå–æ—¶ç”¨åœ¨åŸå§‹å›¾åƒ (365x800)
- âŒ ä½ç½®é”™è¯¯

**ç°åœ¨**:
- é€‰æ‹©æ¡†åœ¨åŸå§‹åæ ‡ç³» (365x800)
- æå–æ—¶ç”¨åœ¨åŸå§‹å›¾åƒ (365x800)
- âœ… ä½ç½®å®Œç¾åŒ¹é…

### æ”¹è¿›2: å…‰æ ‡å˜åŒ–æ­£ç¡®

```python
def mouseMoveEvent(self, event):
    original_point = self.display_to_original_coords(event.pos())

    # ä½¿ç”¨åŸå§‹åæ ‡æ£€æµ‹è¾¹ç¼˜
    for box in self.selection_boxes:
        edge = box.get_resize_edge(original_point, threshold=10)
        if edge:
            if edge in ['top', 'bottom']:
                self.setCursor(Qt.CursorShape.SizeVerCursor)  # â†•ï¸
            elif edge in ['left', 'right']:
                self.setCursor(Qt.CursorShape.SizeHorCursor)  # â†”ï¸
            # ... å…¶ä»–æ–¹å‘
```

### æ”¹è¿›3: è°ƒæ•´å¤§å°ç²¾ç¡®

```python
def resize(self, edge, dx, dy):
    """ä½¿ç”¨åŸå§‹åæ ‡ç³»çš„å¢é‡è°ƒæ•´"""
    if edge == 'top':
        self.rect.setTop(self.rect.top() + dy)
    elif edge == 'bottom':
        self.rect.setBottom(self.rect.bottom() + dy)
    # ... æ‰€æœ‰8ä¸ªæ–¹å‘
```

---

## ğŸ“Š æµ‹è¯•éªŒè¯

### æµ‹è¯•åœºæ™¯1: old.jpg (365 x 800)

**æ­¥éª¤**:
1. åŠ è½½ old.jpg
2. æ·»åŠ é€‰æ‹©æ¡† â†’ å®½åº¦ 365px (å…¨å®½) âœ…
3. æ‹–åŠ¨åˆ°ç¬¬ä¸€å¸§ä½ç½®
4. è°ƒæ•´é«˜åº¦åˆ° 90px
5. å¤åˆ¶7æ¬¡ â†’ æ€»å…±8ä¸ªæ¡†
6. é€ä¸ªå®šä½åˆ°8å¸§
7. ç‚¹å‡»"âœ‚ï¸ æå–"

**é¢„æœŸç»“æœ**:
- æå–8å¸§
- æ¯å¸§å°ºå¯¸ä¸€è‡´ (365 x 90)
- ä½ç½®å®Œç¾åŒ¹é…é€‰æ‹©æ¡† âœ…

### æµ‹è¯•åœºæ™¯2: å¤§å›¾ç‰‡ (1500 x 3000)

**æ­¥éª¤**:
1. åŠ è½½å¤§å›¾ç‰‡
2. çª—å£æ˜¾ç¤ºä¸º 500 x 1000 (ç¼©æ”¾æ¯” 1:3)
3. æ·»åŠ é€‰æ‹©æ¡† â†’ åœ¨åŸå§‹åæ ‡ç³»æ˜¯ 1500pxå®½
4. é¼ æ ‡ç‚¹å‡» (250, 100) åœ¨æ˜¾ç¤ºä¸Š
5. è½¬æ¢ä¸ºåŸå§‹åæ ‡ (750, 300)
6. æ‹–åŠ¨é€‰æ‹©æ¡†
7. æå–åŒºåŸŸ

**é¢„æœŸç»“æœ**:
- åæ ‡è½¬æ¢æ­£ç¡® âœ…
- æå–åŒºåŸŸå‡†ç¡® âœ…

---

## ğŸ¯ è§£å†³çš„é—®é¢˜æ€»ç»“

| é—®é¢˜ | çŠ¶æ€ | è¯´æ˜ |
|------|------|------|
| æå–ä½ç½®ä¸å‡† | âœ… | åæ ‡ç³»ç»Ÿé‡æ„ï¼Œå®Œå…¨åŒ¹é… |
| é»˜è®¤æ¡†å¤ªå®½ | âœ… | æ”¹ä¸º100%å®½åº¦ |
| æ§åˆ¶åŒºåŸŸå¤ªé«˜ | âœ… | ç´§å‡‘å¸ƒå±€ï¼ŒèŠ‚çœ60%é«˜åº¦ |
| é¢„è§ˆåŒºåŸŸç©ºç™½è¿‡å¤š | âœ… | é™åˆ¶æ§åˆ¶åŒºé«˜åº¦120pxï¼Œé¢„è§ˆå¢åŠ 45%ç©ºé—´ |
| å¯åŠ¨æ—¶å´©æºƒ | âœ… | æ·»åŠ å®‰å…¨æ£€æŸ¥ |
| å…‰æ ‡å˜åŒ–ä¸å¯¹ | âœ… | ä½¿ç”¨åŸå§‹åæ ‡æ£€æµ‹ |
| è°ƒæ•´å¤§å°ä¸å‡† | âœ… | åœ¨åŸå§‹åæ ‡ç³»æ“ä½œ |

---

## ğŸš€ ä½¿ç”¨ä½“éªŒ

### ç°åœ¨çš„å·¥ä½œæµ

1. **æ·»åŠ èƒ¶ç‰‡** â†’ åŠ è½½å›¾ç‰‡
2. **æ·»åŠ é€‰æ‹©æ¡†** â†’ é»˜è®¤å…¨å®½ âœ…
3. **è°ƒæ•´ä½ç½®** â†’ æ‹–åŠ¨åˆ°ç¬¬ä¸€å¸§
4. **è°ƒæ•´å¤§å°** â†’ æ‹–åŠ¨è¾¹ç¼˜å®Œç¾è¦†ç›–
5. **å¤åˆ¶æ¡†** â†’ ä¿æŒç›¸åŒå°ºå¯¸
6. **é€ä¸ªå®šä½** â†’ ç§»åŠ¨åˆ°æ¯ä¸€å¸§
7. **æå–** â†’ 100%å‡†ç¡®åŒ¹é… âœ…

### è§†è§‰åé¦ˆ

- ğŸŸ¡ é»„è‰²æ¡† - æœªé€‰ä¸­
- ğŸŸ¢ ç»¿è‰²æ¡† - å·²é€‰ä¸­
- â†•ï¸â†”ï¸ å…‰æ ‡ - è°ƒæ•´å¤§å°æ–¹å‘
- âœ‹ ç§»åŠ¨å…‰æ ‡ - æ‹–åŠ¨æ¨¡å¼

---

## ğŸ’¡ æŠ€æœ¯äº®ç‚¹

### 1. åæ ‡ç©ºé—´åˆ†ç¦»

```
ç”¨æˆ·äº¤äº’å±‚ (æ˜¾ç¤ºåæ ‡) â†â†’ æ•°æ®å­˜å‚¨å±‚ (åŸå§‹åæ ‡)
         â†‘                      â†‘
   event.pos()            box.rect
         â†“                      â†“
display_to_original_coords()    æå–æ—¶ç›´æ¥ä½¿ç”¨
```

### 2. åŒå‘è½¬æ¢

- **æ˜¾ç¤º â†’ åŸå§‹**: `display_to_original_coords()`
- **åŸå§‹ â†’ æ˜¾ç¤º**: `scaled()` æ•´ä½“ç¼©æ”¾

### 3. é˜²å¾¡æ€§ç¼–ç¨‹

æ¯ä¸ªå¯èƒ½å‡ºé”™çš„åœ°æ–¹éƒ½æœ‰æ£€æŸ¥ï¼š
```python
if self.original_pixmap is None or self.display_pixmap is None:
    return  # å®‰å…¨é€€å‡º
```

---

## âœ… å®ŒæˆçŠ¶æ€

æ‰€æœ‰ç”¨æˆ·åé¦ˆçš„é—®é¢˜éƒ½å·²ä¿®å¤ï¼š

1. âœ… "é»˜è®¤åˆ›å»ºçš„é€‰æ‹©æ¡†å¤ªå®½äº†" â†’ æ”¹ä¸º100%å®½åº¦
2. âœ… "æ¡†é€‰åçš„åŒºåŸŸç‚¹å‡»æå–å¹¶ä¸æ­£ç¡®" â†’ åæ ‡ç³»ç»Ÿé‡æ„
3. âœ… "æ‰‹åŠ¨é€‰æ‹©æ¡†groupå˜ä½ä¸€äº›" â†’ ç´§å‡‘å¸ƒå±€èŠ‚çœ60%é«˜åº¦
4. âœ… "åœˆå‡ºæ¥çš„åŒºåŸŸå¤ªé«˜äº†æ²¡å•¥ç”¨ç¼©å°ä¸€ç‚¹" â†’ é™åˆ¶é«˜åº¦120pxï¼Œé¢„è§ˆå¢åŠ 45%ç©ºé—´

**ç°åœ¨å¯ä»¥ç²¾ç¡®æå–ä»»ä½•æ ¼å¼çš„èƒ¶ç‰‡å¸§äº†ï¼** ğŸ¬âœ¨
