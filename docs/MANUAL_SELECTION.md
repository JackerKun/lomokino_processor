# 📐 手动选择框功能使用指南

## 🎯 功能概述

新增了**手动选择框**功能，让您可以精确控制每一帧的提取位置和大小，确保所有帧保持一致。

### ✨ 主要特性

1. **可视化选择框** - 在胶片预览上直接显示黄色选择框
2. **拖动调整** - 用鼠标拖动选择框到正确位置
3. **复制功能** - 一键复制选择框保持尺寸一致
4. **手动提取** - 按选择框顺序提取帧
5. **拖拽排序** - 提取后可拖动帧调整顺序（开发中）

---

## 🚀 快速开始

### 1. 添加胶片

点击左侧"➕ 添加胶片"按钮，或直接拖拽图片到列表。

### 2. 选择胶片

在左侧列表点击一张胶片，预览区会显示胶片图像。

### 3. 添加选择框

点击"➕ 添加选择框"按钮，会在预览区出现一个**黄色矩形框**。

### 4. 调整选择框

- **移动**: 点击黄色框并拖动到目标帧的位置
- **选中**: 被选中的框会变成**绿色**
- **编号**: 每个框左上角显示 #1, #2, #3...

### 5. 复制选择框

选中一个框后，点击"📋 复制选择框"，会在下方创建一个相同大小的新框。

### 6. 提取帧

调整好所有选择框后，点击"✂️ 提取选中区域"，右侧会显示提取的帧。

### 7. 生成视频

设置FPS，点击"🎬 生成视频"。

---

## 📖 详细操作指南

### 选择框控制

#### ➕ 添加选择框
```
功能: 添加一个新的选择框
位置: 默认在上一个框下方
尺寸: 宽度为胶片的84%（去除齿孔）
高度: 默认100px（可通过复制保持一致）
```

**使用场景**:
- 第一次添加框时
- 需要额外的帧时

#### 📋 复制选择框
```
功能: 复制当前选中的选择框
特点:
  - 保持相同的宽度和高度
  - 自动放在原框下方
  - 编号自动递增
```

**使用场景**:
- 确保所有帧大小一致
- 批量添加相同尺寸的框

#### 🗑️ 删除选择框
```
功能: 删除当前选中的选择框
确认: 会弹出确认对话框
结果: 自动重新编号剩余的框
```

#### 🧹 清空所有
```
功能: 删除所有选择框
确认: 会弹出确认对话框
用途: 重新开始布局
```

---

## 💡 使用技巧

### 技巧1: 保持帧尺寸一致

**步骤**:
1. 添加第一个选择框
2. 调整到合适的大小（拖动到第一帧）
3. 不断点击"复制选择框"
4. 逐个拖动到每一帧的位置

**结果**: 所有框大小完全一致 ✅

### 技巧2: 精确定位

**视觉提示**:
- 🟡 **黄色框** = 未选中
- 🟢 **绿色框** = 已选中
- **#数字** = 框的顺序

**操作**:
- 点击框一次 → 变绿色（选中）
- 拖动绿色框 → 移动到新位置
- 点击空白处 → 取消选中

### 技巧3: 处理old.jpg这类小图片

对于像old.jpg (365x800) 这样的图片：

```
1. 添加选择框
2. 调整高度到约90-100px（覆盖一帧）
3. 移动到第一帧位置
4. 复制7次（共8个框）
5. 逐个移动到8个帧的位置
6. 提取选中区域
```

### 技巧4: 快速布局

**对于标准胶片**（有清晰分隔线）:
1. 第一个框放在第一帧
2. 连续复制多个框
3. 它们会自动堆叠
4. 微调每个框的垂直位置即可

---

## 🎨 界面元素

### 胶片预览区

```
┌─────────────────────────────┐
│                             │
│  ┏━━━━━━━━━━━━━━━━━━━━┓    │
│  ┃ #1  [胶片内容]     ┃ ← 黄色框
│  ┗━━━━━━━━━━━━━━━━━━━━┛    │
│                             │
│  ┏━━━━━━━━━━━━━━━━━━━━┓    │
│  ┃ #2  [胶片内容]     ┃    │
│  ┗━━━━━━━━━━━━━━━━━━━━┛    │
│                             │
└─────────────────────────────┘
```

### 控制按钮区

```
┌──────────────────────────────┐
│ 手动选择框控制               │
├──────────────────────────────┤
│ [➕ 添加选择框] [📋 复制选择框] │
│ [🗑️ 删除选择框] [🧹 清空所有]  │
│ [✂️ 提取选中区域]              │
│ 选择框数量: 8                 │
└──────────────────────────────┘
```

### 提取的帧区域

```
┌────────────────────────────────┐
│ 提取的帧                        │
│ 可拖动帧来调整顺序 (开发中)     │
├────────────────────────────────┤
│ [帧1] [帧2] [帧3] [帧4]        │
│ [帧5] [帧6] [帧7] [帧8]        │
│                                │
│ 成功提取 8 帧（手动选择）      │
└────────────────────────────────┘
```

---

## ⚠️ 注意事项

### 1. 必须先选择胶片
```
❌ 没有加载胶片时无法添加选择框
✅ 先在左侧列表选择一张胶片
```

### 2. 删除/复制前需要选中框
```
❌ 点击"复制"时没有选中框 → 提示错误
✅ 先点击一个黄色框使其变绿，再点击"复制"
```

### 3. 选择框必须在图片范围内
```
❌ 拖动到图片外面的框无法提取
✅ 保持框在胶片图像范围内
```

### 4. 提取顺序
```
提取的帧顺序 = 选择框的编号顺序
#1 → 帧1
#2 → 帧2
#3 → 帧3
...
```

---

## 🔄 工作流程

### 完整流程图

```
添加胶片
    ↓
选择查看
    ↓
添加选择框 ───┐
    ↓         │
调整位置      │
    ↓         │
复制选择框 ←──┘ (重复)
    ↓
全部调整完毕
    ↓
提取选中区域
    ↓
查看提取结果
    ↓
(可选)删除不需要的帧
    ↓
设置FPS
    ↓
生成视频
```

### 典型场景: old.jpg

**目标**: 提取8个完整的帧

**步骤**:
1. ✅ 添加 old.jpg 到胶片列表
2. ✅ 点击 old.jpg 查看预览
3. ✅ 点击"添加选择框" → 出现第一个框
4. ✅ 拖动框到第一帧位置（最上方）
5. ✅ 调整框的高度覆盖整个帧
6. ✅ 点击"复制选择框" 7次 → 共8个框
7. ✅ 逐个拖动框到8个帧的位置
8. ✅ 点击"提取选中区域"
9. ✅ 右侧显示8个提取的帧
10. ✅ 设置FPS为12
11. ✅ 点击"生成视频"

**时间**: 约2-3分钟

---

## 🆚 对比: 自动 vs 手动

### 自动检测模式

**优点**:
- ✅ 快速，一键提取
- ✅ 适合标准胶片
- ✅ 无需手动操作

**缺点**:
- ❌ 可能检测不准
- ❌ 无法处理特殊情况
- ❌ 帧数可能不对

**适用**: 分隔线清晰的标准胶片

### 手动选择模式

**优点**:
- ✅ 100%准确
- ✅ 完全控制
- ✅ 帧大小一致
- ✅ 适合所有情况

**缺点**:
- ❌ 需要手动操作
- ❌ 稍微慢一点

**适用**:
- 自动检测不准确时
- 需要精确控制时
- old.jpg这类小图片
- 特殊格式的胶片

---

## 🎯 最佳实践

### 推荐工作流

```
第一次尝试: 使用自动检测
    ↓
检查结果
    ├─ 满意 → 直接生成视频 ✅
    └─ 不满意 → 切换到手动模式
           ↓
       使用手动选择框
           ↓
       精确提取 ✅
```

### 质量检查

提取后必须检查：
- [ ] 帧数是否正确
- [ ] 每个帧是否完整
- [ ] 是否有黑边或多余内容
- [ ] 顺序是否正确

### 保存设置

如果有多张类似的胶片：
1. 第一张用手动模式找到最佳设置
2. 记录选择框的位置和大小
3. 其他图片可以参考相同设置

---

## 🐛 故障排除

### 问题1: 点击"复制"没反应

**原因**: 没有选中框

**解决**:
1. 先点击一个黄色框
2. 框变绿色后
3. 再点击"复制选择框"

### 问题2: 提取的帧是空的或很小

**原因**: 选择框位置不对

**解决**:
1. 检查选择框是否在胶片图像范围内
2. 调整选择框的位置
3. 重新提取

### 问题3: 无法拖动选择框

**原因**: 可能点击位置不准

**解决**:
1. 点击选择框的边框或内部
2. 确保框变成绿色
3. 然后拖动

### 问题4: 选择框数量显示不更新

**原因**: 界面未刷新（罕见）

**解决**:
1. 重新选择胶片
2. 或者重启GUI

---

## 🔜 未来功能

### 计划中的改进

1. **拖拽排序** ✨
   - 在"提取的帧"区域
   - 直接拖动帧调整顺序
   - 实时更新编号

2. **选择框模板**
   - 保存常用的选择框布局
   - 一键应用到新胶片
   - 提高效率

3. **批量操作**
   - 选中多个框同时移动
   - 等间距分布
   - 自动对齐

4. **可视化辅助线**
   - 显示胶片分隔线
   - 对齐网格
   - 尺寸标尺

---

## 📝 快捷键（计划中）

将来可能添加的快捷键：

- `Ctrl/Cmd + A` - 添加选择框
- `Ctrl/Cmd + D` - 复制选择框
- `Delete/Backspace` - 删除选择框
- `↑↓←→` - 微调选择框位置
- `Shift + ↑↓` - 调整选择框高度

---

## 💬 使用提示

### 提示1: 先测试一个
在批量复制选择框之前：
1. 先添加1个框
2. 调整到完美位置和大小
3. 然后再批量复制

### 提示2: 使用编号
利用选择框的编号（#1, #2...）：
- 确认提取顺序
- 检查是否有遗漏
- 方便沟通和记录

### 提示3: 对比预览
提取后对比原图和提取的帧：
- 确保没有裁切掉重要内容
- 检查是否包含多余的黑边

---

## ✅ 总结

### 何时使用手动选择

**推荐使用手动选择的情况**:
1. ✅ 自动检测失败或不准确
2. ✅ 需要精确控制每一帧
3. ✅ 处理old.jpg这类小尺寸图片
4. ✅ 胶片格式特殊或不标准
5. ✅ 需要确保所有帧大小一致

### 核心优势

- 🎯 **精确控制** - 100%按您的意图
- 📏 **尺寸一致** - 复制功能保证一致性
- 🔍 **可视化** - 实时查看选择位置
- ✂️ **灵活性** - 适应任何胶片格式

---

**开始使用手动选择框功能，完全掌控您的胶片提取！** 🎬✨
