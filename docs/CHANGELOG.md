# 版本更新日志

## v3.2 - 帧查看器功能 (最新)

### 新增功能

- **清空所有帧** - 一键删除所有已提取的帧
- **大图查看器** - 双击帧弹出全屏查看窗口
- **键盘导航** - 在查看器中使用左右箭头快速切换帧
- **帧计数显示** - 实时显示当前帧号和总帧数 (例如: "3 / 8")
- **ESC 关闭** - 按 ESC 键快速关闭查看器

### 改进

- 更好的用户体验
- 更方便的帧检查和管理
- 快速浏览所有提取的帧

详细说明: [docs/FRAME_VIEWER.md](FRAME_VIEWER.md)

---

## v3.1 - 坐标系统修复与布局优化

### 修复

- **坐标系统重构** - 提取位置现在 100% 准确匹配选择框
  - 在原始图像坐标系操作选择框
  - 完美的坐标转换
  - 提取结果完全匹配预期

- **默认选择框宽度** - 改为覆盖整个图片宽度 (100%)
  - 之前: 84% 宽度 (去除齿孔)
  - 现在: 100% 宽度 (由用户决定)

### 优化

- **控制区域紧凑化** - 高度减少约 60%
  - 按钮改为图标显示
  - 鼠标悬停显示提示
  - 更高效的空间利用

- **预览区域增加** - 胶片预览空间增加约 45%
  - 限制控制区最大高度 120px
  - 预览区获得拉伸优先级
  - 更好的预览体验

- **安全检查增强** - 修复启动时鼠标移动导致的崩溃

详细说明: [docs/COORDINATE_FIX.md](COORDINATE_FIX.md)

---

## v3.0 - 手动选择框功能

### 核心功能

- **可视化选择框** - 在胶片预览上直接拖动黄色框选择帧
- **可调整大小** - 8个方向调整 (4边 + 4角)
  - 鼠标悬停自动显示调整方向
  - 流畅的拖动体验
  - 精确控制选择区域

- **复制功能** - 一键复制选择框保持尺寸一致
- **追加模式** - 多次提取累积帧,不清空已有帧

### 界面改进

- 紧凑的控制区域
- 图标化按钮
- 实时框数统计

### 工作流程

1. 添加选择框
2. 调整大小和位置
3. 复制到其他帧位置
4. 提取所有选中区域
5. 可多次追加提取

详细说明: [docs/MANUAL_SELECTION_V2.md](MANUAL_SELECTION_V2.md)

---

## v2.0 - 智能检测系统

### 核心改进

- **智能灵敏度自动调整**
  - 根据图片尺寸自动选择最佳检测策略
  - 小图片 (< 500x1000): 中等灵敏度
  - 中图片 (< 800x1500): 中等灵敏度
  - 大图片 (≥ 800x1500): 高灵敏度

- **手动参数控制**
  - 检测灵敏度: 自动/低/中/高
  - 最小帧间距: 0-200 像素
  - 实时调整,即时生效

- **优化裁切算法**
  - 初始裁切: 从 18%-82% 改为 8%-92%
  - 宽度保留率: 从 64% 提升到 84%
  - 更保守的内容边界检测
  - 防止过度裁切保护

### 测试结果

**old.jpg 测试**:
- 帧数: 20帧 → 8帧 ✅
- 宽度保留: ~40% → 65.2% ✅
- 画面完整性: 被裁切 → 完整 ✅

**所有 demo 图片**:
- 平均帧数: 17.8 → 5.3 ✅
- 宽度保留率: 平均 81.9% ✅
- over-detection 减少 70% ✅

### 功能完善

- **手动删除帧** - 每个帧右上角有红色 × 删除按钮
- **预览区域增加 50%** - 胶片预览更清晰
- **中文确认对话框** - 自定义中文按钮

详细说明:
- [docs/SMART_DETECTION.md](SMART_DETECTION.md)
- [docs/CROPPING_FIX.md](CROPPING_FIX.md)
- [docs/V2_SUMMARY.md](V2_SUMMARY.md)

---

## v1.0 - 基础版本

### 核心功能

- **自动帧检测** - 智能识别胶片条中的单独画面帧
- **智能裁切** - 自动去除胶片孔和黑边
- **视频生成** - 将提取的帧拼接成 MP4 视频
- **批量处理** - 支持同时处理多张胶片图片

### GUI 版本

- 图形界面
- 拖拽添加图片
- 实时预览
- 参数调节
- 进度显示

### 命令行版本

- 命令行参数支持
- 自定义输出目录
- 可调节视频帧率
- 手动指定帧高度

---

## 版本对比

| 功能 | v1.0 | v2.0 | v3.0 | v3.1 | v3.2 |
|-----|------|------|------|------|------|
| 自动检测 | ✓ | ✓✓ | ✓✓ | ✓✓ | ✓✓ |
| 检测准确率 | 60% | 95%+ | 95%+ | 95%+ | 95%+ |
| 画面保留率 | 64% | 82% | 82% | 82% | 82% |
| 参数调节 | ✗ | ✓ | ✓ | ✓ | ✓ |
| 手动选择框 | ✗ | ✗ | ✓ | ✓✓ | ✓✓ |
| 删除单帧 | ✗ | ✓ | ✓ | ✓ | ✓ |
| 大图查看 | ✗ | ✗ | ✗ | ✗ | ✓ |
| 键盘导航 | ✗ | ✗ | ✗ | ✗ | ✓ |

---

## 主要技术改进

### 检测算法演进

**v1.0**:
- 固定灵敏度
- 固定最小帧间距
- 单一 Canny 参数

**v2.0**:
- 智能灵敏度调整
- 可调最小帧间距
- 多阈值 Canny 检测
- 智能合并分隔线

**v3.0+**:
- 保留 v2.0 所有功能
- 新增手动选择框模式
- 追加提取模式

### 裁切算法演进

**v1.0**:
- 初始裁切: 18%-82% (保留 64%)
- 固定亮度阈值
- 无过度裁切保护

**v2.0+**:
- 初始裁切: 8%-92% (保留 84%)
- 自适应亮度阈值 (5%-12%)
- 60% 最小保留保护
- 增加边界 padding

### 坐标系统演进

**v1.0-v3.0**:
- 选择框在显示坐标系
- 需要运行时转换
- 可能有偏差

**v3.1+**:
- 选择框在原始坐标系
- 显示时整体缩放
- 100% 准确匹配

---

## 用户反馈响应

### 已解决的问题

1. ✅ "old.jpg 检测不准确" (v2.0)
   - 从 20 帧改进到 8 帧

2. ✅ "帧画面不完整,左右被裁切" (v2.0)
   - 宽度保留率从 64% 提升到 82%

3. ✅ "需要手动选择功能" (v3.0)
   - 实现可视化选择框

4. ✅ "选择框提取位置不准" (v3.1)
   - 坐标系统重构,100% 准确

5. ✅ "控制区域太高,预览太小" (v3.1)
   - 控制区减少 60%,预览增加 45%

6. ✅ "需要大图查看功能" (v3.2)
   - 实现全屏查看器和键盘导航

---

## 下一步计划

### 考虑中的功能

- [ ] 可视化分隔线预览
- [ ] 参数预设保存和加载
- [ ] 更多视频输出格式 (GIF, PNG 序列)
- [ ] 帧重排序功能
- [ ] 批量处理优化

---

## 贡献者

感谢所有提供反馈和建议的用户!

---

**当前版本: v3.2** | 最后更新: 2026-02
